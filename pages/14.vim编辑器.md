### vim
vim [options] [file...]  
+#:打开文件后,直接让光标处于第#行的行首;  
+/PATTERN:打开文件后,直接让光标处于第一个被PATTERN匹配到的行行首;  


```shell
#打开文件并定位到第5行,第一列
vim +5 fstab

#copy文件
cp /etc/rc.d/init.d/functions ./
#直接让光标处于第一个被"if"匹配到的行行首
vim +/if functions

#光标定位在尾行打开
vim + functions
```

模式转换:  
编辑模式:默认模式  
编辑模式-->输入模式:  
i:insert,在光标所在处输入;  
a:append,在光标所在处后方输入;  
o:在光标所在处的下方打开一个新行;  
I:在光标所在行的行首输入;  
A:在光标所在行的行尾输入;  
O:在光标所在处的上方打开一个新行;  

输入模式-->编辑模式:  
ESC  

编辑模式-->末行模式:  
:

末行模式-->编辑模式:  
ESC

关闭文件:  
ZZ:保存并退出;  

:q 退出;  
:q! 强制退出不保存;    
:wq 保存并退出;  
:x 保存并退出;  
:w /PATH/TO/SOMEFILE 另存为;  

![](https://images.gitee.com/uploads/images/2019/0706/092138_84fef409_1479682.png)  


### 光标跳转  
字符间跳转  
h:左  
j:下  
k:上  
i:右  

#COMMAND:跳转由#指定的个数的字符  
例如:10h;  

单词间跳转  
w:下一个单词的词首;  
e:当前或后一个单词的词尾;  
b:当前或前一个单词的词首;  
#COMMAND:跳转由#指定的个数的单词  

行首行尾跳转  
^:跳转至行首的第一个非空白字符;  
0:跳转至行首;  
$:跳转至行尾;  

行间跳转  
#G:跳转至由#指定的行;  
1G,gg:第一行;
G:最后一行;    

句间跳转:  
(   
)   

段间跳转:  
{   
}    

翻屏:  
Ctrl+f:向文件尾部翻一屏   
Ctrl+b:向文件首部翻一屏  
Ctrl+d:向文件首部翻半屏  
Ctrl+u:向文件首部翻半屏  
Enter:按行向后翻  

### vim的编辑命令:  
字符编辑：  
x:删除光标所在处的字符;  
#x:删除光标所在处起始的#个字符;  
xp:交换光标所在处的字符与其后面的字符的位置;  

替换命令(replace)：  
r:替换光标所在处的字符;(输入r+键盘上的字符)  
  
删除命令:  
d:删除命令、可结合光标跳转字符,实现范围删除;  
d$:从光标所在处删除到行尾;  
d^:从光标所在处删除到行首;  
dd:删除光标所在行的一整行； 
#dd:删除光标所处的行起始的#行;  

粘贴命令  
p:缓冲区中的内容如果为整行,则粘贴在当前光标所在行的下方;否则,则粘贴至当前光标所在处的后方;  
P:  缓冲区中的内容如果为整行,则粘贴在当前光标所在行的上方;否则,则粘贴至当前光标所在处的前方;  

复制命令(yank,y)  
y:复制,工作行为相似于d命名;  
yy:复制一整行;  
y$:复制从光标到行尾;    
y^:复制光标到行首;  
y0:复制到行首,行首部有空格包含空格,Tab等一起复制;  
#yy:复制n行,如:5yy;  

改变命令(change,c)  
c  
操作完后编辑模式转换为输入模式,实现删除操作  
和d命令一样,区别是会转换为输入模式  
比如:cc删除整行后,就可以输入内容了  

### 其他编辑操作

可视化模式  
v:按字符选定;  
V:按行选定;  

结合编辑命令使用:d,c,y  

撤销(undo)操作:  
u:撤销此前的操作;  
#u:操作此前#个的操作;如4u,撤销此前的4次操作;  

恢复此前的撤销操作:  
Ctrl+r  


重复执行前一个编辑操作  
.  

vim自带的练习教程,使用命令:vimtutor  


### vim末行模式:  
内建的命令行接口  

(1) 地址定界  
`:start_pos[,end_pos]`  
`#`:特定的第#行,例如5即第5行;  
`.`:当前行;  
`$`:最后一行;  
`#,#`:指定行范围,左侧为起始行,右侧为结束行;  
`#,+#`:指定行范围,左侧为起始行绝对编号,右侧为相对左侧行号的偏移量;例如:3+7  
`.,$-1`:从当前行到倒数第二行  
`1,$`:全文    
`%`:全文  
`/pattern/`:从光标所在处起始向文件尾部第一次被模式所匹配到的行;  
`/first/,$`:比如匹配光标所在处起始带有first的行之后的所有行;例如删除操作:`:/first/,$d`    
`/pat1/,/pat2/`:从光标所在处起始,第一次由pat1匹配到的行开始,至第一次由pat2匹配到的行结束之间的所有行;  

可同编辑命令一同使用,实现编辑操作:  
d  
y  
c  
w /PATH/TO/SOMEFILE:将范围内的文本保存至指定的文件中;    
r /PATH/FORM/SOMEFILE:将指定的文件中的文本读取并插入至指定位置;例如将text.txt的5行加入到某文件:`:5r /root/test.txt`  

(2) 查找  
/PATTERN:从当前光标所在处向文件尾部查找能够被当前模式匹配到的所有字符串;  
?PATTERN:从当前光标所在处向文件首部查找能够被当前模式匹配到的所有字符串;   
n:下一个,与命令方向相同;  
N:上一个,与命令方向相反;  

(3) 查找并替换  
$:末行模式的命令;使用格式:  
s/要查找的内容/替换为的内容/修饰符  
要查找的内容:可使用正则表达式;  
替换为的内容:不能使用正则表达式,但可以引用;   
如果"要查找的内容"部分在模式中使用分组符号:在"替换为的内容"中使用后向引用;  
如果"要查找的内容"部分在模式中没有使用分组符号:在"替换为的内容"中可以直接引用查找模式匹配到的全本文本;要使用&符号;    
修饰符:  
i:忽略大小写;  
g:全局替换,意味着一行中如果匹配到多次,则替换;(不使用全局替换,默认只替换匹配到每一行中的第一次出现)  


末行模式下搜索全文所有的this替换成This且使用全局替换忽略大小写:`:%s/this/This/ig`  
末行模式下搜索1,20行所有的this替换成This且使用全局替换忽略大小写:`:1,20s/this/This/ig`  

可把分隔符替换为其它非常用字符:  
s@@@  
s###  

将/run/systemd替换为/etc/sysconfig:`%s/\/run\/systemd\/system/\/etc\/sysconfig/gi`其中的"/"要用转义看起来可读性很差,我们可以用@或者#来表示分隔符:`%s@/run/systemd/system@/etc/sysconfig@gi`  

替换文件中所有以小写t开头的单词,将t替换成大写的T:`%s@\<t\([[:alpha:]]\+\)\>@T\1@g`  
将所有t开头的单词后加上er,这里使用了直接引用:`:%s@\<t[[:alpha:]]\+\>@&er@g`  
将以#开头的行首替换成空串:`%s@^#@`  

练习:  
1、复制/etc/grub2.cfg文件至/tmp目录中,用查找替换命令删除/tmp/grub2.cfg文件中以空白字符开头的行的行首的空白字符;  
```shell
:%s@^[[:space:]]\+@
```

2、复制/etc/rc.d/init.d/functions文件至/tmp目录中,用查找替换命令为/tmp/functions文件的每个以空白字符开头的行的行首加上#;  
```shell
:%s@^[[:space:]]@#& 
#如果不希望空白行前加#,可以如下写法
:%s@^[[:space:]]\+[^[:space:]]@#& 
```


3、为/tmp/grub2.cfg文件的前三行的行首加上#号;  
```shell
:1,3s@.\+@#&
```

4、将/etc/yum.repos.d/CentOS-Base.repo文件中的所有的enabled=0替换为enabled=1,所有的gpgcheck=0替换为gpgcheck=1;  
```shell
%s@\(enabled\|gpgcheck\)=0@\1=1@g
```  


### vim的多文件功能:  
多文件:  
vim FILE1 FILE2 ...  
`vim grub2.cfg functions storage.log`
末行模式下多个打开的文件中切换：  
`:next`  切换到下一个文件  
`:prev`  切换到上一个文件  
`:last`  切换到最后一个文件  
`:first` 切换到第一个文件  
`:wqall` 保存所有文件并退出  
`:wall`  保存所有文件  
`:qall`  退出所有文件  

多窗口:  
-o:水平分割窗口  
-O:垂直分割窗口  

在窗口间切换:Ctrl+w,松开Ctrl单独按上、下、左、右键  

注意:单个文件也可以分割为多个窗口进行查看:  
Ctrl+w,松开Ctrl单独按s:水平分割窗口  
Ctrl+w,松开Ctrl单独按v:垂直分割窗口  

```shell
#水平分割窗口
vim -o grub2.cfg functions storage.log
#垂直分割窗口
vim -O grub2.cfg functions storage.log
```


### 定制vim的工作特性  
注意:在末行模式下的设定,仅对当前vim进程有效有效;  
永久有效:  
全局:/etc/vimrc  
用户个人:~/.vimrc  
1、行号  
显示:set number,简写为set nu  
取消显示:set nonumber,简写为set nonu  

2、自动缩进  
启用:set autoindent,set ai  
禁用:set noautoindent,set noai  

3、高亮搜索  
启用:set hlsearch  
禁用:set nohlsearch  

4、语法高亮  
启用:syntax on  
禁用:syntax off  

6、忽略字符大小写  
启用:set ic  
禁用:set noic  

获取末行模式的帮助:   
只需要在末行模式下:  
:help  
:help subject
比如:  
`:help`  
`:help set`


7、搜索完关键字,去除关键字高亮显示   
在Vim里面如果要搜索某个关键字,只要键入/xxx就可以了,比如,搜索一个函数,键入/snprintf,然后回车,一个文件中,所有出现这个字样的地方都会被高亮显示。按n键，就可以自动把光标跳到下一个.但是,用好这个功能,怎么消除高亮呢?  
只需要末行模式下输入:noh即可;  






